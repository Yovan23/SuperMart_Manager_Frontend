<div class="p-d-flex p-jc-between p-ai-center p-mb-1">
  <h2 class="p-mr-auto">Product Management</h2>
  <button
    pButton
    icon="pi pi-plus"
    class="p-button-text p-mr-2"
    style="color: aliceblue; background-color: rgb(1, 118, 30)"
    pTooltip="Add Product"
    tooltipPosition="top"
    (click)="openAddDialog()"
  >
    Add Product
  </button>
</div>
<br>

<!-- <div class="card mb-3">
    <div class="flex flex-wrap gap-2">
        <p-selectButton [options]="categoryOptions" [(ngModel)]="selectedCategory" 
            optionLabel="name" optionValue="_id" 
            (onChange)="onCategoryChange($event)">
            <ng-template let-item>
                <div class="px-3 py-2">{{ item.name }}</div>
            </ng-template>
        </p-selectButton>
    </div>
</div> -->

<div class="card">
  <p-table
    #dt
    [value]="products"
    dataKey="_id"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [loading]="loading"
    [paginator]="true"
    [globalFilterFields]="['name', 'description', 'categoryId', 'barcode']"
    styleClass="p-datatable-gridlines p-datatable-sm custom-column-filter p-component"
  >
    <ng-template pTemplate="header">
      <tr>
        <th class="p-2">Name</th>
        <th class="p-2">Description</th>
        <th class="p-2">Category</th>
        <th class="p-2">Quantity</th>
        <th class="p-2">Price</th>
        <th class="p-2">Barcode</th>
        <th class="p-2">Volume</th>
        <th class="p-2">Unit</th>
        <th class="p-2">Visibility</th>
        <th class="p-2">Actions</th>
      </tr>
      <tr>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #nameFilter
            (input)="dt.filter(nameFilter.value, 'name', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #descriptionFilter
            (input)="
              dt.filter(descriptionFilter.value, 'description', 'contains')
            "
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #categoryFilter
            (input)="dt.filter(categoryFilter.value, 'categoryId', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #quantityFilter
            (input)="dt.filter(quantityFilter.value, 'quantity', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #priceFilter
            (input)="dt.filter(priceFilter.value, 'price', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #barcodeFilter
            (input)="dt.filter(barcodeFilter.value, 'barcode', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #volumeFilter
            (input)="dt.filter(volumeFilter.value, 'volume', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <input
            pInputText
            type="text"
            #unitFilter
            (input)="dt.filter(unitFilter.value, 'unit', 'contains')"
            placeholder="Search"
            class="p-column-filter w-full p-1 text-sm"
          />
        </th>
        <th class="p-2">
          <select
            pInputText
            #visibilityFilter
            (change)="dt.filter(visibilityFilter.value, 'isVisible', 'equals')"
            class="p-column-filter"
          >
            <option [value]="">All</option>
            <option [value]="true">Visible</option>
            <option [value]="false">Hidden</option>
          </select>
        </th>
        <th class="p-2"></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-product>
      <tr>
        <td class="p-2">{{ product.name }}</td>
        <td class="p-2">{{ product.description }}</td>
        <td class="p-2">{{ getCategoryName(product.categoryId) }}</td>
        <td class="p-2">{{ product.quantity }}</td>
        <td class="p-2">{{ product.price }}</td>
        <td class="p-2">{{ product.barcode }}</td>
        <td class="p-2">{{ product.volume }}</td>
        <td class="p-2">{{ product.unit }}</td>
        <td class="p-2">
          <p-tag
            [value]="product.isVisible ? 'Visible' : 'Hidden'"
            [severity]="getSeverity(product.isVisible)"
          />
        </td>
        <td class="p-2">
          <div class="flex gap-1">
            <button
              pButton
              icon="pi pi-pencil"
              class="p-button-text p-0"
              pTooltip="Edit Product"
              tooltipPosition="top"
              (click)="openEditDialog(product)"
            ></button>
            <button
              pButton
              icon="pi pi-trash"
              class="p-button-text p-0"
              pTooltip="Delete Product"
              tooltipPosition="top"
              (click)="openDeleteDialog(product)"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="10" class="p-text-center">No products found.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<app-edit-dialog
  [visible]="editDialogVisible"
  [dialogTitle]="'Edit Product'"
  [fields]="productEditFields"
  [formData]="selectedProduct"
  (visibleChange)="editDialogVisible = $event"
  (save)="updateProduct($event)"
>
</app-edit-dialog>

<app-add-dialog
  [visible]="addDialogVisible"
  [dialogTitle]="'Add Product'"
  [fields]="productAddFields"
  [useFormData]="false"
  (visibleChange)="addDialogVisible = $event"
  (save)="createProduct($event)"
>
</app-add-dialog>

<app-delete-dialog
  [(visible)]="deleteDialogVisible"
  [dialogTitle]="'Delete Product'"
  [message]="'Are you sure you want to delete this product?'"
  [description]="
    'This action cannot be undone. The product will be permanently removed.'
  "
  (confirm)="confirmDelete()"
>
</app-delete-dialog>

<app-snackbar
  [(visible)]="snackbarVisible"
  [type]="snackbarConfig.type"
  [title]="snackbarConfig.title"
  [message]="snackbarConfig.message"
>
</app-snackbar>
